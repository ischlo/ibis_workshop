<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.26">

  <meta name="author" content="Ivann Schlosser">
  <meta name="dcterms.date" content="2025-12-16">
  <title>High performance out of memory analytics</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto-899626c24cf0cda272c67d51e524f74b.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">High performance out of memory analytics</h1>
  <p class="subtitle">Software Carpentry</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="ischlosser.com">Ivann Schlosser</a> 
</div>
<div class="quarto-title-author-email">
<a href="mailto:ivann.schlosser@ouce.ox.co.uk">ivann.schlosser@ouce.ox.co.uk</a>
</div>
        <p class="quarto-title-affiliation">
            Oxford Progamme for Sustainable Infrastructure Systems (OPSIS)
          </p>
    </div>
</div>

  <p class="date">16 December 2025</p>
</section>
<section>
<section id="introduction-to-ibis-duckdb" class="title-slide slide level1 center">
<h1>Introduction to IBIS + DuckDB</h1>

</section>
<section id="welcome" class="slide level2">
<h2>Welcome</h2>
<p>This workshpop will present an alternative tool for the data scientists and engineers to work with (very) large data sets with performances that can not be matched by the standard set of tools (pandas + geopandas). Specifically we talk today about an SQL and it’s DuckDB <em>dialect</em>, and <code>ibis</code>, a python package helping us interact directly with an SQL backend (a database) and query it with a more familiar python syntax.</p>
<h3 id="summary">Summary</h3>
<ol type="1">
<li>Introduction</li>
<li>SQL Overview
<ul>
<li>DuckDB</li>
<li>extension : spatial</li>
</ul></li>
<li>ibis</li>
<li>Live demo</li>
<li>Notebook Review</li>
</ol>
</section>
<section id="duckdb-vs-pandas" class="slide level2">
<h2>DuckDB vs Pandas</h2>
<p>Or more generally, <code>SQL</code> against <code>python</code>(<code>R</code>) based analytics pipelines.</p>
<p>Depends on the use case, lower level kinds of tools tend to be tedious to set up, require adhering to stricter rules and more complex syntax.</p>
<p>Can yield great performance improvements.</p>
<p>Higher level tools will be more user friendly, easy to set up, less performance.</p>
<p>For small to medium data (<span class="math inline">\(\approx 100 MB\)</span>), the difference will not necessarily be striking, but beyond that, it can be game changing.</p>
<p>Some tools try to bring together the best of both worlds, however require introducing an additional layer of abstraction that can take some time to adapt to. <code>ibis</code> is such a tool.</p>
<h3 id="from-the-creator-of-both-himself">From the creator of both himself</h3>
<p><a href="https://wesmckinney.com/blog/apache-arrow-pandas-internals/"><strong>Apache Arrow and the “10 Things I Hate About pandas</strong></a></p>
<ol start="2" type="1">
<li>Memory mapping huge datasets</li>
<li>High speed data ingest and export (databases and file formats)</li>
<li>Keeping memory allocations in check</li>
<li>Query planning, <strong>multicore execution</strong></li>
</ol>
</section>
<section id="sql" class="slide level2">
<h2>SQL</h2>
<h3 id="glossary">Glossary</h3>
<dl>
<dt>Structured Query Language</dt>
<dd>
has been developped to work on structured tables.
</dd>
<dt>(R)DBMS</dt>
<dd>
(Relational) DataBase Management System
</dd>
<dt>OLAP</dt>
<dd>
OnLine Analitical Processing
</dd>
</dl>
</section>
<section id="sql-1" class="slide level2">
<h2>SQL</h2>
<ul>
<li>Exisits in open source versions (SQLite, PostgreSQL, DuckDB) and commercial (MongoDB, Oracle …)</li>
<li><strong>Not</strong> a general purpose programming language (unlike python, R, C, C++, Java…)</li>
<li>Designed for work on data tables</li>
</ul>
<p>From data file in memory, to table in a database</p>
<ul>
<li>Data tables need to be strictly defined through a <strong>schema</strong> and registered on the database.</li>
</ul>
<div id="665cefd2" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sepal_length</th>
<th data-quarto-table-cell-role="th">sepal_width</th>
<th data-quarto-table-cell-role="th">petal_length</th>
<th data-quarto-table-cell-role="th">petal_width</th>
<th data-quarto-table-cell-role="th">species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>5.1</td>
<td>3.5</td>
<td>1.4</td>
<td>0.2</td>
<td>setosa</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>4.9</td>
<td>3.0</td>
<td>1.4</td>
<td>0.2</td>
<td>setosa</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>For example the commonly used <code>iris</code> data set.</p>
<div id="2b0f55e8" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display" data-execution_count="10">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe caption-top" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">petal_length</th>
<td>float64</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">petal_width</th>
<td>float64</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sepal_length</th>
<td>float64</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">sepal_width</th>
<td>float64</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">species</th>
<td>string</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sql-2" class="slide level2">
<h2>SQL</h2>
<p>A general template for an sql query:</p>
<div class="columns">
<div class="column" style="width:33%;">
<p>Selecting, grouping, aggregating</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource {sql} number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href=""></a>SELECT select_list </span>
<span id="cb1-2"><a href=""></a>FROM tables</span>
<span id="cb1-3"><a href=""></a>WHERE condition</span>
<span id="cb1-4"><a href=""></a></span>
<span id="cb1-5"><a href=""></a>GROUP BY groups</span>
<span id="cb1-6"><a href=""></a>HAVING group_filter</span>
<span id="cb1-7"><a href=""></a>    WINDOW window_expression</span>
<span id="cb1-8"><a href=""></a>    QUALIFY qualify_filter</span>
<span id="cb1-9"><a href=""></a>ORDER BY order_expression</span>
<span id="cb1-10"><a href=""></a>LIMIT n;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column" style="width:33%;">
<p>Joining two tables</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode numberSource {sql} number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"><a href=""></a>SELECT a.cols, b.cols, FUNCTION(cols)</span>
<span id="cb2-2"><a href=""></a>FROM table_a as a</span>
<span id="cb2-3"><a href=""></a>JOIN table_b as b</span>
<span id="cb2-4"><a href=""></a>  ON a.join_col = b.join_col</span>
<span id="cb2-5"><a href=""></a>GROUP BY group_col</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column" style="width:33%;">
<p>Window functions</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource {sql} number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1"><a href=""></a>SELECT cols, </span>
<span id="cb3-2"><a href=""></a>    FUNCTION(cols) OVER win_name AS new_col</span>
<span id="cb3-3"><a href=""></a>FROM mytable</span>
<span id="cb3-4"><a href=""></a>WINDOW win_name AS (</span>
<span id="cb3-5"><a href=""></a>    PARTITION BY partition_col</span>
<span id="cb3-6"><a href=""></a>    ORDER BY order_col ASC</span>
<span id="cb3-7"><a href=""></a>    RANGE BETWEEN interval PRECEDING</span>
<span id="cb3-8"><a href=""></a>              AND interval FOLLOWING)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<!-- end columns -->
</section>
<section id="sql-3" class="slide level2">
<h2>SQL</h2>
<p>Many useful functionalities are provided with base SQL,</p>
<h3 id="view">View</h3>
<!-- virtual tables
table expressions -->
<p>Imagine having an SQL experession, that takes an existing table and does some operations on it. Maybe this table itself is not necessarily the end goal of your analysis, it serves an intermediate purpose. Because of that, you might not want to save it in your database, you would rather want something temporary that you can call when you need, but otherwise it would not occupy extra space. In such cases, it is common to use <strong>views</strong>. They allow saving an unrealised query. And when you actually need the data from it, you call the view and manipulate it just like a table.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource {sql} number-lines code-with-copy"><code class="sourceCode"><span id="cb4-1"><a href=""></a></span>
<span id="cb4-2"><a href=""></a>-- create view</span>
<span id="cb4-3"><a href=""></a>CREATE VIEW view_name AS (SELECT ... );</span>
<span id="cb4-4"><a href=""></a></span>
<span id="cb4-5"><a href=""></a>-- refer to the view as if it was a table</span>
<span id="cb4-6"><a href=""></a>SELECT * FROM view_name;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This will be important to better understand what is going on later on.</p>
</section>
<section id="sql-4" class="slide level2">
<h2>SQL&nbsp;</h2>
<h3 id="index">Index</h3>
<p>An important feature of databases, that really differentiates them as the best tool around for manipulating data, is indices. Indices find their root in quite fundamental computer science concepts and are closely related to dimensionality reduction, information representation, optimisation. The topic is <strong>vast</strong>. An index implements an ordering into data allowing much faster querying and ultimately much faster results.</p>
<blockquote>
<p>The Cambridge dictionary has around <span class="math inline">\(N = 140,000\)</span> words. Imagine how challenging it would be to find a definition if it was completely unordered. This is what we do generally with our data… The complexity of the operation would be of the order of the number of entries <span class="math inline">\(N \approx 10^5\)</span>. Dictionaries are indexed alphabetically, making a search operation for a word of the order <span class="math inline">\(ln(N) \approx 12\)</span>.</p>
</blockquote>
<div class="columns">
<div class="column" style="width:60%;">
<p>They are defined other columns or sets of columns and implement an ordering. The algorithm depends on the type of the column, such as strings, numericals or geometries. The topic of indexing and optimisation could deserve a workshop of it’s own and is a whole field in computer science, with many algorithms remaining <em>sub-optimal</em>.</p>
<p>In practice, some software packages such as DuckDB will build indices by default, giving close to optimal performance out of the box.</p>
</div><div class="column" style="width:40%;">
<div id="33e0af89" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/cell-5-output-1.png" width="418" height="302"></p>
</figure>
</div>
</div>
</div>
</div></div>
<!-- end columns -->
<!-- Indices allow to optimise queries -->
</section></section>
<section>
<section id="duckdb" class="title-slide slide level1 center">
<h1>DuckDB</h1>

</section>
<section id="duckdb-1" class="slide level2">
<h2>DuckDB</h2>
<p>A <em>dialect</em> of SQL, it is pretty much the same with some little extras that are meant to expand or facilitate cetain functionalities that traditional SQL does no have. It has been developped by a dutch team and has received great recognition lately for it’s usability, performance, light weight and fast evolving community and extensions, including the <em>spatial</em> one.</p>
<blockquote>
<p>It’s hard to set up tables in a SQL database, for example Postgres… You need to stick to a strict, pre-defined schema, the type of tools needed may vary depending on the input (csv, parquet, geospatial). Often, you need a separate command line tool to run the process. It tends to be a pain…</p>
</blockquote>
<p>In DuckDB, reading almost any file looks like that:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource {sql} number-lines code-with-copy"><code class="sourceCode"><span id="cb5-1"><a href=""></a></span>
<span id="cb5-2"><a href=""></a>DESCRIBE SELECT * FROM 'myfile.parquet';</span>
<span id="cb5-3"><a href=""></a></span>
<span id="cb5-4"><a href=""></a>SELECT * FROM 'folder_with_files/*.parquet'; -- uses read_parquet</span>
<span id="cb5-5"><a href=""></a></span>
<span id="cb5-6"><a href=""></a>SELECT * FROM 'myfile.csv'; -- uses read_csv</span>
<span id="cb5-7"><a href=""></a></span>
<span id="cb5-8"><a href=""></a>SELECT * FROM 'myfile.shp'; -- uses st_read from the spatial extension</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>thanks to a feature called <em>replacement scans</em>.</p>
</section>
<section id="useful-links-sql" class="slide level2">
<h2>Useful links SQL</h2>
<ul>
<li>https://www.w3schools.com/sql/sql_intro.asp</li>
<li>https://www.geeksforgeeks.org/sql/what-is-sql/</li>
<li>https://duckdb.org/docs/stable/sql/introduction</li>
<li>https://duckdb.org/docs/stable/data/overview</li>
</ul>
<p>And of course ask chatGPT, it’s quite good at that</p>
</section></section>
<section>
<section id="connecting-python-to-duckdb" class="title-slide slide level1 center">
<h1>Connecting <code>python</code> to DuckDB</h1>

</section>
<section id="calling-a-db-engine-from-python" class="slide level2">
<h2>Calling a DB engine from python</h2>
<p>There are other existing ways to run code on an SQL database from a python script, but it usuallly looks like that:</p>
<h3 id="connection">Connection</h3>
<div id="e857826d" class="cell columns column-output-location" data-execution_count="5">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href=""></a><span class="im">import</span> ibis <span class="im">as</span> ib</span>
<span id="cb6-2"><a href=""></a></span>
<span id="cb6-3"><a href=""></a>conn <span class="op">=</span> ib.<span class="ex">connect</span>(<span class="st">"duckdb://"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">

</div></div>
<h3 id="query">Query</h3>
<p>Run and get some results in python.</p>
<div id="2efa7bf3" class="cell columns column-output-location" data-execution_count="6">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href=""></a>val <span class="op">=</span> <span class="fl">.4</span></span>
<span id="cb7-2"><a href=""></a></span>
<span id="cb7-3"><a href=""></a>res_sql <span class="op">=</span> conn.sql(<span class="ss">f"""</span></span>
<span id="cb7-4"><a href=""></a><span class="ss">    SELECT * FROM iris WHERE petal_width&gt;</span><span class="sc">{</span>val<span class="sc">}</span><span class="ss">;</span></span>
<span id="cb7-5"><a href=""></a><span class="ss">"""</span>)</span>
<span id="cb7-6"><a href=""></a></span>
<span id="cb7-7"><a href=""></a>res_sql.head(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-display" data-execution_count="12">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> sepal_length </span>┃<span style="font-weight: bold"> sepal_width </span>┃<span style="font-weight: bold"> petal_length </span>┃<span style="font-weight: bold"> petal_width </span>┃<span style="font-weight: bold"> species    </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │
├──────────────┼─────────────┼──────────────┼─────────────┼────────────┤
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.1</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.7</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5</span> │ <span style="color: #008000; text-decoration-color: #008000">setosa    </span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.0</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.6</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.6</span> │ <span style="color: #008000; text-decoration-color: #008000">setosa    </span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.0</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.2</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.7</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4</span> │ <span style="color: #008000; text-decoration-color: #008000">versicolor</span> │
└──────────────┴─────────────┴──────────────┴─────────────┴────────────┘
</pre>
</div>
</div></div>
<p>We are writing SQL queries as python strings and then sending them other to the backend through a <code>.sql</code> method of the client connection object <code>conn</code>. Using various string methods, this already gives us some nice possibilities, such as fstring for a parameter. And as you will see, there are times when this is our best solution.</p>
<p>But for most cases, we can do better than that.</p>
<!-- This is where `ibis` comes in.  -->
</section>
<section id="ibis" class="slide level2">
<h2>ibis</h2>
<p>ibis is the link between powerfull backend infrastructure and user friendly <code>python</code> functions and workflows. It allows writing code in a simpler and more familiar similar syntax to <code>pandas</code>, heavily inspired by the <code>tidyverse</code> and <code>dplyr</code> analisys flows in <code>R</code><sup>1</sup>.</p>
<blockquote>
<p>What if instead we could have a more familiar syntax, more adapted to our python workflow, such as pandas, that would be translated into SQL, then possibly optimised and finally executed in the database ?</p>
</blockquote>
<p><strong>Say no more !</strong></p>
<p>With ibis, our previous query is written as</p>
<div id="074ca5a6" class="cell columns column-output-location" data-execution_count="7">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href=""></a><span class="co"># ibis</span></span>
<span id="cb8-2"><a href=""></a>expr <span class="op">=</span> iris.<span class="bu">filter</span>(_.petal_width<span class="op">&gt;</span>val)</span>
<span id="cb8-3"><a href=""></a>expr.head(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-display" data-execution_count="13">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> sepal_length </span>┃<span style="font-weight: bold"> sepal_width </span>┃<span style="font-weight: bold"> petal_length </span>┃<span style="font-weight: bold"> petal_width </span>┃<span style="font-weight: bold"> species    </span>┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━━┩
│ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>      │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">float64</span>     │ <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">string</span>     │
├──────────────┼─────────────┼──────────────┼─────────────┼────────────┤
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.1</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.3</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.7</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.5</span> │ <span style="color: #008000; text-decoration-color: #008000">setosa    </span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">5.0</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.5</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.6</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.6</span> │ <span style="color: #008000; text-decoration-color: #008000">setosa    </span> │
│          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">7.0</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">3.2</span> │          <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4.7</span> │         <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.4</span> │ <span style="color: #008000; text-decoration-color: #008000">versicolor</span> │
└──────────────┴─────────────┴──────────────┴─────────────┴────────────┘
</pre>
</div>
</div></div>
<p>Notice the <code>_</code> object, it is imported from ibis and replaces the table in this context. It’s a handy way around having to write the table name every time.</p>
<h3 id="pandas">Pandas</h3>
<div id="f7a5fd05" class="cell columns column-output-location" data-execution_count="8">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href=""></a><span class="co"># pandas</span></span>
<span id="cb9-2"><a href=""></a>res <span class="op">=</span> iris_df.loc[iris_df.petal_width<span class="op">&gt;</span>val]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">

</div></div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>https://r4ds.had.co.nz/introduction.html</p></li></ol></aside></section>
<section id="looking-behind-the-curtain" class="slide level2">
<h2>Looking behind the curtain</h2>
<p>Ibis handily provides us with a function to visualise the SQL expression that is created in the background from our python code. This can be seen as a view that ibis writes for us. It is only executed when we need it, and only as much from it as we need.</p>
<div id="7d77b1dc" class="cell columns column-output-location" data-execution_count="9">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href=""></a>ib.to_sql(expr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href=""></a><span class="kw">SELECT</span></span>
<span id="cb11-2"><a href=""></a>  <span class="op">*</span></span>
<span id="cb11-3"><a href=""></a><span class="kw">FROM</span> <span class="ot">"iris"</span> <span class="kw">AS</span> <span class="ot">"t0"</span></span>
<span id="cb11-4"><a href=""></a><span class="kw">WHERE</span></span>
<span id="cb11-5"><a href=""></a>  <span class="ot">"t0"</span>.<span class="ot">"petal_width"</span> <span class="op">&gt;</span> <span class="fl">0.4</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
<p>The python variable <code>expr</code> that we created, represents an unrealised SQL expression on the backend side. Is lazilly evaluated when needed. For example, calling the <code>head(3)</code> method will only compute the requested first 3 rows. Instead of going through the whole table before returning only 3 elements. It’s an object very close to an SQL view, that we saw earlier.</p>
</section>
<section id="extensions" class="slide level2">
<h2>Extensions</h2>
<p>More here: - Official: https://duckdb.org/docs/stable/core_extensions/overview - Community: https://duckdb.org/community_extensions/</p>
<h3 id="notable">Notable</h3>
<h4 id="spatial">Spatial</h4>
<p>For working with spatial data.</p>
<p>Docs: https://github.com/duckdb/duckdb-spatial Blog: https://motherduck.com/blog/geospatial-for-beginner-duckdb-spatial-motherduck/</p>
<h4 id="quackosm">QuackOSM</h4>
<p>For Reading raw OSM buffer files directly into a duckdb database with a convenient data schema.</p>
<p>https://github.com/kraina-ai/quackosm</p>
<h4 id="h3">H3</h4>
<p>Extension for the UBER H3 API to work with spatial data.</p>
<ul>
<li>https://github.com/isaacbrodsky/h3-duckdb</li>
</ul>
</section>
<section id="performance-more" class="slide level2">
<h2>Performance &amp; More</h2>
<ul>
<li>https://github.com/prrao87/duckdb-study</li>
<li>https://www.kdnuggets.com/we-benchmarked-duckdb-sqlite-and-pandas-on-1m-rows-heres-what-happened</li>
<li>https://motherduck.com/blog/duckdb-versus-pandas-versus-polars/</li>
<li>https://www.codecentric.de/en/knowledge-hub/blog/duckdb-vs-dataframe-libraries</li>
<li>https://pipeline2insights.substack.com/p/pandas-vs-polars-vs-duckdb-vs-pyspark-benchmarking-real-experiments</li>
</ul>
</section>
<section id="docs" class="slide level2">
<h2>DOCS</h2>
<h3 id="sql-5">SQL</h3>
<p>PostgreSQL : https://www.postgresql.org/docs/current/queries-table-expressions.html</p>
<h3 id="duckdb-2">DuckDB</h3>
<ul>
<li>https://duckdb.org/docs/stable/</li>
<li><a href="https://motherduck.com/duckdb-action-book/?utm_adgroup=186712428885&amp;utm_term=duckdb%20tutorial&amp;utm_campaign=23233670124&amp;utm_source=google&amp;utm_medium=search&amp;utm_content=783048558613&amp;hsa_acc=6957541599&amp;hsa_cam=23233670124&amp;hsa_grp=186712428885&amp;hsa_ad=783048558613&amp;hsa_src=g&amp;hsa_tgt=kwd-1902524828862&amp;hsa_kw=duckdb%20tutorial&amp;hsa_mt=b&amp;hsa_net=adwords&amp;hsa_ver=3&amp;gad_source=1&amp;gad_campaignid=23233670124&amp;gbraid=0AAAAApg_UmBOE8xe24ZtIxHzWL6XpEj5v&amp;gclid=Cj0KCQiAgP_JBhD-ARIsANpEMxwhy6GmIAay7jSjD12olaRc48VygaP1cXBA_3WycpsiK29qMabsO5IaAkF_EALw_wcB">Hands on DuckDB book</a></li>
</ul>
<h3 id="ibis-1">ibis</h3>
<p>The ibis documentation is not very advanced at this point, but some blog posts have been helpfull, understanding SQL, and of course just trying things. - https://ibis-project.org/posts</p>

</section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="https://www.rstudio.com/wp-content/uploads/2018/10/RStudio-Logo-Flat.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Getting started with IBIS + DuckDB</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>